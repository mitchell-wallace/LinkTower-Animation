---
/**
 * Promo Animation Page
 * Phase 5: Complete with export controls
 */
import "@/styles/global.css";
import PromoLink from "../promo/PromoLink.astro";
import { leftColumnLinks, centerColumnLinks, rightColumnLinks, shouldShowLogo } from "../promo/data";

// Frame dimensions (3:2 aspect ratio at ~720p)
const FRAME_WIDTH = 1080;
const FRAME_HEIGHT = 720;

// Rotation configuration
const ROTATION_DEG = 30;

// Calculate scale to fill frame after rotation
const SCALE = 1.8;

// Animation configuration
const ANIMATION_DURATION = 15; // seconds per loop
---

<!DOCTYPE html>
<html lang="en" data-theme="treelink-light">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>LinkTower Promo Animation</title>
  <style>
    /* Infinite scroll animation - scrolls 50% (one full content set) */
    @keyframes scroll-down {
      from { transform: translateY(0); }
      to { transform: translateY(-50%); }
    }
    @keyframes scroll-up {
      from { transform: translateY(-50%); }
      to { transform: translateY(0); }
    }
    .animate-scroll-down {
      animation: scroll-down var(--duration) linear infinite;
    }
    .animate-scroll-up {
      animation: scroll-up var(--duration) linear infinite;
    }
  </style>
</head>
<body class="min-h-screen bg-neutral-800 flex items-center justify-center p-8">
  
  <!-- Frame container - exact 1080x720 dimensions -->
  <div 
    id="promo-frame"
    class="relative overflow-hidden bg-gradient-to-br from-base-100 to-base-200"
    style={`width: ${FRAME_WIDTH}px; height: ${FRAME_HEIGHT}px;`}
  >
    <!-- Rotated content container -->
    <div 
      id="rotated-content"
      class="absolute"
      style={`
        width: ${FRAME_WIDTH}px;
        height: ${FRAME_HEIGHT}px;
        left: 50%;
        top: 50%;
        transform: translate(-50%, -50%) rotate(${ROTATION_DEG}deg) scale(${SCALE});
        transform-origin: center center;
      `}
    >
      <!-- Three column layout -->
      <div class="absolute inset-0 flex gap-2 p-3" style={`--duration: ${ANIMATION_DURATION}s;`}>
        
        <!-- Left Column - scrolls UP -->
        <div class="flex-1 overflow-hidden">
          <div class="flex flex-col gap-2 animate-scroll-up">
            {/* First set */}
            {leftColumnLinks.map((link) => (
              <PromoLink link={link} />
            ))}
            {/* Duplicate for seamless loop */}
            {leftColumnLinks.map((link) => (
              <PromoLink link={link} />
            ))}
          </div>
        </div>
        
        <!-- Center Column - scrolls DOWN -->
        <div class="flex-1 overflow-hidden">
          <div class="flex flex-col gap-2 animate-scroll-down">
            {/* First set */}
            {centerColumnLinks.map((link, index) => (
              <PromoLink link={link} showLogo={shouldShowLogo(index)} />
            ))}
            {/* Duplicate for seamless loop */}
            {centerColumnLinks.map((link, index) => (
              <PromoLink link={link} showLogo={shouldShowLogo(index)} />
            ))}
          </div>
        </div>
        
        <!-- Right Column - scrolls UP -->
        <div class="flex-1 overflow-hidden">
          <div class="flex flex-col gap-2 animate-scroll-up">
            {/* First set */}
            {rightColumnLinks.map((link) => (
              <PromoLink link={link} />
            ))}
            {/* Duplicate for seamless loop */}
            {rightColumnLinks.map((link) => (
              <PromoLink link={link} />
            ))}
          </div>
        </div>
        
      </div>
    </div>
  </div>
  
  <!-- Control Panel -->
  <div id="control-panel" class="fixed bottom-4 left-4 bg-black/90 text-white text-sm px-5 py-4 rounded-xl shadow-2xl">
    <div class="flex flex-col gap-3">
      <!-- Timer -->
      <div class="flex items-center gap-3">
        <span class="text-gray-400 text-xs uppercase tracking-wide">Time</span>
        <span id="timer" class="font-mono text-lg">0.0s</span>
        <span class="text-gray-500">/ {ANIMATION_DURATION}s</span>
      </div>
      
      <!-- Controls -->
      <div class="flex items-center gap-3">
        <button 
          id="play-pause" 
          class="px-3 py-1.5 bg-blue-600 hover:bg-blue-500 rounded-md font-medium transition-colors"
        >
          Pause
        </button>
        
        <label class="flex items-center gap-2">
          <span class="text-gray-400 text-xs">Speed</span>
          <select id="speed" class="bg-gray-800 border border-gray-700 rounded px-2 py-1 text-sm">
            <option value="0.5">0.5x</option>
            <option value="1" selected>1x</option>
            <option value="1.5">1.5x</option>
            <option value="2">2x</option>
          </select>
        </label>
      </div>
      
      <!-- Export Info -->
      <div class="text-xs text-gray-400 border-t border-gray-700 pt-2 mt-1">
        Frame: {FRAME_WIDTH}x{FRAME_HEIGHT} | {ROTATION_DEG}Â° rotation | {ANIMATION_DURATION}s loop
      </div>
    </div>
  </div>
  
  <!-- Export Instructions -->
  <div class="fixed top-4 right-4 bg-black/80 text-white text-xs px-4 py-3 rounded-lg max-w-xs">
    <p class="font-medium mb-1">To export as video:</p>
    <ol class="list-decimal list-inside text-gray-300 space-y-0.5">
      <li>Use OBS or screen recorder</li>
      <li>Set to {FRAME_WIDTH}x{FRAME_HEIGHT} region</li>
      <li>Record for {ANIMATION_DURATION}s</li>
      <li>Export as MP4/WebM</li>
    </ol>
  </div>
  
  <script define:vars={{ ANIMATION_DURATION }}>
    // Control panel functionality
    const timer = document.getElementById('timer');
    const playPauseBtn = document.getElementById('play-pause');
    const speedSelect = document.getElementById('speed');
    const animatedElements = document.querySelectorAll('.animate-scroll-down, .animate-scroll-up');
    
    let isPlaying = true;
    let startTime = Date.now();
    let pausedAt = 0;
    
    // Update timer display
    function updateTimer() {
      if (isPlaying) {
        const elapsed = ((Date.now() - startTime) / 1000) % ANIMATION_DURATION;
        timer.textContent = elapsed.toFixed(1) + 's';
      }
      requestAnimationFrame(updateTimer);
    }
    updateTimer();
    
    // Play/Pause
    playPauseBtn.addEventListener('click', () => {
      isPlaying = !isPlaying;
      playPauseBtn.textContent = isPlaying ? 'Pause' : 'Play';
      
      animatedElements.forEach(el => {
        el.style.animationPlayState = isPlaying ? 'running' : 'paused';
      });
      
      if (isPlaying) {
        startTime = Date.now() - (pausedAt * 1000);
      } else {
        pausedAt = parseFloat(timer.textContent);
      }
    });
    
    // Speed control
    speedSelect.addEventListener('change', (e) => {
      const speed = parseFloat(e.target.value);
      const newDuration = ANIMATION_DURATION / speed;
      
      animatedElements.forEach(el => {
        el.style.animationDuration = newDuration + 's';
      });
    });
  </script>
  
</body>
</html>
